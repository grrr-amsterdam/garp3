<?php
/**
 * Generated PHP model
 *
 * @package Garp_Spawn
 * @author  David Spreekmeester <david@grrr.nl>
 */
class Garp_Spawn_Php_Model_Localized extends Garp_Spawn_Php_Model_Abstract {
    const MODEL_DIR = '/modules/default/Model/';

    /**
     * @var String $_locale
     */
    protected $_locale;


    /**
     * @param   Garp_Spawn_Model_Base   $model      The base model this habtm model is connected to
     * @param   String                  $locale     F.i.: 'en' or 'nl'
     */
    public function __construct(Garp_Spawn_Model_Base $model, $locale) {
        parent::__construct($model);

        $this->setLocale($locale);
    }

    public function isOverwriteEnabled() {
        return true;
    }

    public function getPath() {
        $model  = $this->getModel();
        $locale = ucfirst($this->getLocale());
        return APPLICATION_PATH . self::MODEL_DIR . $model->id . $locale . '.php';
    }

    /**
     * @return String
     */
    public function getLocale() {
        return $this->_locale;
    }

    /**
     * @param String $locale
     * @return void
     */
    public function setLocale($locale) {
        $this->_locale = $locale;
    }

    public function render() {
        $model = $this->getModel();
        $locale = $this->getLocale();

        $parentClass = 'Model_' . $model->id;
        $className = $parentClass . ucfirst($locale);

        $view = new Garp_Spawn_Db_View_I18n($model, $locale);
        $viewName = $view->getName();

        $out = $this->_rl("<?php")
            . $this->_rl('/**')
            . $this->_rl(" * {$className}")
            . $this->_rl(' * This file was generated by ' . get_class() . ' - do not edit')
            . $this->_rl(' *')
            . $this->_rl(' * @package Model')
            . $this->_rl(' * @author ' . get_class() . ' <garp@grrr.nl>')
            . $this->_rl(' */')
            . $this->_rl("class {$className} extends {$parentClass} {", 0)
            . $this->_rl("protected \$_name = '{$viewName}';", 1)
            . $this->_rl("}", 0, 0);

        return $out;
    }
}
